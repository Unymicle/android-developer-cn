<!DOCTYPE html>












































































<html>
<head>


<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width" />

<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>任务和活动堆栈 | 安卓开发者</title><!-- STYLESHEETS --><!-- JAVASCRIPT -->


<link rel="stylesheet"
href="http://fonts.googleapis.com/css?family=Roboto:regular,medium,thin,italic,mediumitalic,bold" title="roboto">
<link href="../../assets/css/default.css" rel="stylesheet" type="text/css">




<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "../../";
  var devsite = false;
</script>
<script src="../../assets/js/docs.js" type="text/javascript"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5831155-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="gc-documentation 
  develop guide" itemscope itemtype="http://schema.org/Article"><!-- Header -->

<a name="top"></a>

    
    <div id="header">
        <div class="wrap" id="header-wrap">
          <div class="col-3 logo">
          <a href="../../index.html">
            <img src="../../assets/images/dac_logo.png" width="123" height="25" alt="Android Developers" />
          </a>
          <div class="btn-quicknav" id="btn-quicknav">
          	<a href="#" class="arrow-inactive">Quicknav</a>
			      <a href="#" class="arrow-active">Quicknav</a>
          </div>
          </div>
            <ul class="nav-x col-9">
                <li class="design">
                  <a href="../../design/index.html"
                  zh-tw-lang="設計"
                  zh-cn-lang="设计"
                  ru-lang="Проектирование"
                  ko-lang="디자인"
                  ja-lang="設計"
                  es-lang="Diseñar"               
                  >设计</a></li>
                <li class="develop"><a href="../../develop/index.html"
                  zh-tw-lang="開發"
                  zh-cn-lang="开发"
                  ru-lang="Разработка"
                  ko-lang="개발"
                  ja-lang="開発"
                  es-lang="Desarrollar"               
                  >开发</a></li>
                <li class="distribute last"><a href="../../distribute/index.html"
                  zh-tw-lang="發佈"
                  zh-cn-lang="分发"
                  ru-lang="Распространение"
                  ko-lang="배포"
                  ja-lang="配布"
                  es-lang="Distribuir"               
                  >分发</a></li>
            </ul><!-- New Search -->
            
            
            <div class="menu-container">
            <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Links</div>
      <ul>
        <li><a href="https://play.google.com/apps/publish/">Google Play Developer Console</a></li>
        <li><a href="http://android-developers.blogspot.com/">Android Developers Blog</a></li>
        <li><a href="../../about/index.html">About Android</a></li>
      </ul>
      <div class="header">Android Sites</div>
      <ul>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li class="active"><a>Android Developers</a></li>
        <li><a href="http://source.android.com">Android Open Source Project</a></li>
      </ul>
      
      
      
      


      <br class="clearfix" />
    </div>
    <div class="bottom"></div>
  </div>
  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
onkeydown="return search_changed(event, true, '../../')" 
onkeyup="return search_changed(event, false, '../../')" />
      </form>
      <div class="right"></div>
        <a class="close hide">close</a>
        <div class="left"></div>
        <div class="right"></div>
    </div>
  </div>

  <div class="search_filtered_wrapper reference">
    <div class="suggest-card reference no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  <div class="search_filtered_wrapper docs">
    <div class="suggest-card dummy no-display">&nbsp;</div>
    <div class="suggest-card develop no-display">
      <ul class="search_filtered">
      </ul>
      <div class="child-card guides no-display">
      </div>
      <div class="child-card training no-display">
      </div>
    </div>
    <div class="suggest-card design no-display">
      <ul class="search_filtered">
      </ul>
    </div>
    <div class="suggest-card distribute no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  </div><!-- /New Search>
          
          
          <!-- Expanded quicknav -->
  
           <div id="quicknav" class="col-9">
                <ul>
                    <li class="design">
                      <ul>
                        <li><a href="../../design/index.html">入门</a></li>
                        <li><a href="../../design/style/index.html">样式</a></li>
                        <li><a href="../../design/patterns/index.html">设计模式</a></li>
                        <li><a href="../../design/building-blocks/index.html">构造块</a></li>
                        <li><a href="../../design/downloads/index.html">下载</a></li>
                        <li><a href="../../design/videos/index.html">视频</a></li>
                      </ul>
                    </li>
                    <li class="develop">
                      <ul>
                        <li><a href="../../training/index.html"
                          zh-tw-lang="訓練課程"
                          zh-cn-lang="培训"
                          ru-lang="Курсы"
                          ko-lang="교육"
                          ja-lang="トレーニング"
                          es-lang="Capacitación"               
                          >训练课程</a></li>
                        <li><a href="../../guide/components/index.html"
                          zh-tw-lang="API 指南"
                          zh-cn-lang="API 指南"
                          ru-lang="Руководства по API"
                          ko-lang="API 가이드"
                          ja-lang="API ガイド"
                          es-lang="Guías de la API"               
                          >API 指南</a></li>
                        <li><a href="../../reference/packages.html"
                          zh-tw-lang="參考資源"
                          zh-cn-lang="参考"
                          ru-lang="Справочник"
                          ko-lang="참조문서"
                          ja-lang="リファレンス"
                          es-lang="Referencia"               
                          >参考资源</a></li>
                        <li><a href="../../tools/index.html"
                          zh-tw-lang="相關工具"
                          zh-cn-lang="工具"
                          ru-lang="Инструменты"
                          ko-lang="도구"
                          ja-lang="ツール"
                          es-lang="Herramientas"               
                          >开发工具</a>
                          <ul><li><a href="../../sdk/index.html">获取 SDK</a></li></ul>
                        </li>
                        <li><a href="../../google/index.html">Google 服务</a>
                        </li>
                        
                      </ul>
                    </li>
                    <li class="distribute last">
                      <ul>
                        <li><a href="../../distribute/index.html">Google Play 市场</a></li>
                        <li><a href="../../distribute/googleplay/publish/index.html">应用发布</a></li>
                        <li><a href="../../distribute/googleplay/promote/index.html">应用推广</a></li>
                        <li><a href="../../distribute/googleplay/quality/index.html">应用质量</a></li>
                        <li><a href="../../distribute/googleplay/spotlight/index.html">精品聚焦</a></li>
                        <li><a href="../../distribute/open.html">开放发行</a></li>
                      </ul>
                    </li>
                </ul>
          </div><!-- /Expanded quicknav -->
          
        </div>
    </div><!-- /Header -->
    
    
    
  <div id="searchResults" class="wrap" style="display:none;">
          <h2 id="searchTitle">Results</h2>
          <div id="leftSearchControl" class="search-control">Loading...</div>
  </div><!-- Secondary x-nav -->
    
    
  
    
    <div id="nav-x">
        <div class="wrap">
            <ul class="nav-x col-9 develop" style="width:100%">
                <li class="training"><a href="../../training/index.html"
                  zh-tw-lang="訓練課程"
                  zh-cn-lang="培训"
                  ru-lang="Курсы"
                  ko-lang="교육"
                  ja-lang="トレーニング"
                  es-lang="Capacitación"               
                  >训练课程</a></li>
                <li class="guide"><a href="../../guide/components/index.html"
                  zh-tw-lang="API 指南"
                  zh-cn-lang="API 指南"
                  ru-lang="Руководства по API"
                  ko-lang="API 가이드"
                  ja-lang="API ガイド"
                  es-lang="Guías de la API"               
                  >API 指南</a></li>
                <li class="reference"><a href="../../reference/packages.html"
                  zh-tw-lang="參考資源"
                  zh-cn-lang="参考"
                  ru-lang="Справочник"
                  ko-lang="참조문서"
                  ja-lang="リファレンス"
                  es-lang="Referencia"               
                  >参考资源</a></li>
                <li class="tools"><a href="../../tools/index.html"
                  zh-tw-lang="相關工具"
                  zh-cn-lang="工具"
                  ru-lang="Инструменты"
                  ko-lang="도구"
                  ja-lang="ツール"
                  es-lang="Herramientas"
                  >开发工具</a></li>
                <li class="google"><a href="../../google/index.html"
                  >Google 服务</a>
                </li>
                
            </ul>
        </div>
        
    </div><!-- /Sendondary x-nav -->
    
  




  

  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">
<a class="totop" href="#top" data-g-event="left-nav-top">to top</a>



<ul id="nav"><!--  Walkthrough for Developers -- quick overview of what it's like to develop on Android --><!--<li style="color:red">Overview</li> -->
  
  

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/components/index.html">
        <span class="en">应用组件</span>
      </a></div>
    <ul>
      <li><a href="../../guide/components/fundamentals.html">
            <span class="en">应用基本知识</span></a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/components/activities.html">
            <span class="en">活动</span>
          </a></div>
        <ul>
          <li><a href="../../guide/components/fragments.html">
              <span class="en">活动片段</span>
            </a></li>
          <li><a href="../../guide/components/loaders.html">
              <span class="en">加载器</span>
            </a></li>
          <li><a href="../../guide/components/tasks-and-back-stack.html">
              <span class="en">任务和活动堆栈</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/components/services.html">
            <span class="en">服务</span>
          </a></div>
        <ul>
          <li><a href="../../guide/components/bound-services.html">
              <span class="en">绑定服务</span>
            </a></li>
          <li><a href="../../guide/components/aidl.html">
              <span class="en">AIDL</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/providers/content-providers.html">
            <span class="en">内容提供商</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/providers/content-provider-basics.html">
              <span class="en">内容提供商基础</span>
            </a></li>
          <li><a href="../../guide/topics/providers/content-provider-creating.html">
              <span class="en">创建一个内容提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/calendar-provider.html">
              <span class="en">日历提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/contacts-provider.html">
              <span class="en">联系人提供商</span>
            </a></li>
          <li><a href="../../guide/topics/providers/document-provider.html">
              <span class="en">存储访问框架</span>
            </a></li>
        </ul>
      </li>
      <li><a href="../../guide/components/intents-filters.html">
          <span class="en">意图与意图过滤器</span>
        </a></li>
      <li><a href="../../guide/components/processes-and-threads.html">
          <span class="en">进程和线程</span>
        </a>
      </li>
      <li><a href="../../guide/topics/security/permissions.html">
          <span class="en">权限</span>
        </a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/appwidgets/index.html">
            <span class="en">应用小部件</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/appwidgets/host.html">
              <span class="en">应用小部件托管</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/manifest/manifest-intro.html">
          <span class="en">安卓项目清单</span>
        </a></div>
        <ul>
          <li><a href="../../guide/topics/manifest/action-element.html">&lt;action&gt;</a></li>
          <li><a href="../../guide/topics/manifest/activity-element.html">&lt;activity&gt;</a></li>
          <li><a href="../../guide/topics/manifest/activity-alias-element.html">&lt;activity-alias&gt;</a></li>
          <li><a href="../../guide/topics/manifest/application-element.html">&lt;application&gt;</a></li>
          <li><a href="../../guide/topics/manifest/category-element.html">&lt;category&gt;</a></li>
          <li><a href="../../guide/topics/manifest/compatible-screens-element.html">&lt;compatible-screens&gt;</a></li>
          <li><a href="../../guide/topics/manifest/data-element.html">&lt;data&gt;</a></li>
          <li><a href="../../guide/topics/manifest/grant-uri-permission-element.html">&lt;grant-uri-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/instrumentation-element.html">&lt;instrumentation&gt;</a></li>
          <li><a href="../../guide/topics/manifest/intent-filter-element.html">&lt;intent-filter&gt;</a></li>
          <li><a href="../../guide/topics/manifest/manifest-element.html">&lt;manifest&gt;</a></li>
          <li><a href="../../guide/topics/manifest/meta-data-element.html">&lt;meta-data&gt;</a></li>
          <li><a href="../../guide/topics/manifest/path-permission-element.html">&lt;path-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-element.html">&lt;permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-group-element.html">&lt;permission-group&gt;</a></li>
          <li><a href="../../guide/topics/manifest/permission-tree-element.html">&lt;permission-tree&gt;</a></li>
          <li><a href="../../guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></li>
          <li><a href="../../guide/topics/manifest/receiver-element.html">&lt;receiver&gt;</a></li>
          <li><a href="../../guide/topics/manifest/service-element.html">&lt;service&gt;</a></li>
          <li><a href="../../guide/topics/manifest/supports-gl-texture-element.html">&lt;supports-gl-texture&gt;</a></li>
          <li><a href="../../guide/topics/manifest/supports-screens-element.html">&lt;supports-screens&gt;</a></li><!-- ##api level 4## -->
          <li><a href="../../guide/topics/manifest/uses-configuration-element.html">&lt;uses-configuration&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-feature-element.html">&lt;uses-feature&gt;</a></li><!-- ##api level 4## --> 
          <li><a href="../../guide/topics/manifest/uses-library-element.html">&lt;uses-library&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-permission-element.html">&lt;uses-permission&gt;</a></li>
          <li><a href="../../guide/topics/manifest/uses-sdk-element.html">&lt;uses-sdk&gt;</a></li>
        </ul>
   </li><!-- end of the manifest file -->

    </ul>
  </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/topics/ui/index.html">
        <span class="en">用户界面</span>
      </a></div>
    <ul>
      <li><a href="../../guide/topics/ui/overview.html">
          <span class="en">概述</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/declaring-layout.html">
            <span class="en">布局</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/layout/linear.html">
              <span class="en">线性布局</span>
            </a></li>
          <li><a href="../../guide/topics/ui/layout/relative.html">
              <span class="en">相对布局</span>
            </a></li><!--
          <li><a href="../../guide/topics/ui/layout/grid.html">
              <span class="en">Grid Layout</span>
            </a></li>
       -->
       
          <li><a href="../../guide/topics/ui/layout/listview.html">
              <span class="en">列表视图</span>
            </a></li>
          <li><a href="../../guide/topics/ui/layout/gridview.html">
              <span class="en">网格视图</span>
            </a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/controls.html">
            <span class="en">输入控件</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/controls/button.html">
              <span class="en">按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/text.html">
              <span class="en">文本框</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/checkbox.html">
              <span class="en">复选框</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/radiobutton.html">
              <span class="en">单选按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/togglebutton.html">
              <span class="en">切换按钮</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/spinner.html">
              <span class="en">下拉列表</span>
            </a></li>
          <li><a href="../../guide/topics/ui/controls/pickers.html">
              <span class="en">选择器</span>
            </a></li><!--
          <li><a href="../../guide/topics/ui/controls/progress.html">
              <span class="en">Seek and Progress Bars</span>
            </a></li>
-->

        </ul>
      </li>
      <li><a href="../../guide/topics/ui/ui-events.html">
          <span class="en">输入事件</span>
        </a></li>
      <li><a href="../../guide/topics/ui/menus.html">
          <span class="en">菜单</span></span>
          </a></li>
      <li><a href="../../guide/topics/ui/actionbar.html">
           <span class="en">操作栏</span>
          </a></li>
      <li><a href="../../guide/topics/ui/settings.html">
            <span class="en">设置</span>
          </a></li>
      <li><a href="../../guide/topics/ui/dialogs.html">
           <span class="en">对话框</span>
          </a></li>
      <li><a href="../../guide/topics/ui/notifiers/notifications.html">
          <span class="en">通知</span>
        </a></li>
      <li><a href="../../guide/topics/ui/notifiers/toasts.html">
          <span class="en">提醒框</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/search/index.html">
            <span class="en">搜索</span>
          </a></div>
          <ul>
            <li><a href="../../guide/topics/search/search-dialog.html">创建一个搜索界面</a></li>
            <li><a href="../../guide/topics/search/adding-recent-query-suggestions.html">添加最近查询建议</a></li>
            <li><a href="../../guide/topics/search/adding-custom-suggestions.html">添加自定义建议</a></li>
            <li><a href="../../guide/topics/search/searchable-config.html">可搜索配置</a></li>
          </ul>
      </li>
      <li><a href="../../guide/topics/ui/drag-drop.html">
          <span class="en">拖放</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/ui/accessibility/index.html">
            <span class="en">辅助功能</span>
          </a></div>
        <ul>
          <li><a href="../../guide/topics/ui/accessibility/apps.html">
              <span class="en">让应用可访问</span>
            </a></li>
          <li><a href="../../guide/topics/ui/accessibility/checklist.html">
              <span class="en">辅助功能开发者清单</span>
            </a></li>
          <li><a href="../../guide/topics/ui/accessibility/services.html">
              <span class="en">构建辅助功能服务</span>
            </a></li>
        </ul>
      </li>
      <li><a href="../../guide/topics/ui/themes.html">
          <span class="en">样式与主题</span>
        </a></li>
      <li><a href="../../guide/topics/ui/custom-components.html">
          <span class="en">自定义组件</span>
        </a></li>
    </ul>
  </li><!-- end of User Interface -->

    <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/resources/index.html">
           <span class="en">应用资源</span>
         </a></div>
      <ul>
        <li><a href="../../guide/topics/resources/overview.html">
            <span class="en">概述</span>
          </a></li>
          <li><a href="../../guide/topics/resources/providing-resources.html">
            <span class="en">提供资源</span>
          </a></li>
        <li><a href="../../guide/topics/resources/accessing-resources.html">
            <span class="en">访问资源</span>
          </a></li>
        <li><a href="../../guide/topics/resources/runtime-changes.html">
              <span class="en">处理运行时更改</span>
            </a></li>
        <li><a href="../../guide/topics/resources/localization.html">
            <span class="en">本地化</span>
          </a></li>
        <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/resources/available-resources.html">
              <span class="en">资源类型</span>
            </a></div>
          <ul>
            <li><a href="../../guide/topics/resources/animation-resource.html">动画</a></li>
            <li><a href="../../guide/topics/resources/color-list-resource.html">颜色状态列表</a></li>
            <li><a href="../../guide/topics/resources/drawable-resource.html">可描绘资源</a></li>
            <li><a href="../../guide/topics/resources/layout-resource.html">布局</a></li>
            <li><a href="../../guide/topics/resources/menu-resource.html">菜单</a></li>
            <li><a href="../../guide/topics/resources/string-resource.html">字符串</a></li>
            <li><a href="../../guide/topics/resources/style-resource.html">样式</a></li>
            <li><a href="../../guide/topics/resources/more-resources.html">更多类型</a></li>
          </ul>
        </li><!-- end of resource types -->
      </ul>
    </li><!-- end of app resources -->

   <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/graphics/index.html">
          <span class="en">动画与图形</span>
        </a></div>
      <ul>
      <li class="nav-section">
        </li><li><a href="../../guide/topics/graphics/overview.html">
            <span class="en">概述</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/prop-animation.html">
            <span class="en">属性动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/view-animation.html">
            <span class="en">补间动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/drawable-animation.html">
            <span class="en">帧动画</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/2d-graphics.html">
            <span class="en">画布与图形</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/opengl.html">
            <span class="en">OpenGL ES</span>
          </a></li>
        <li><a href="../../guide/topics/graphics/hardware-accel.html">
            <span class="en">硬件加速</span>
          </a></li>
       </ul>
    </li><!-- end of graphics and animation-->

   <li class="nav-section">
            <div class="nav-section-header"><a href="../../guide/topics/renderscript/index.html">
              <span class="en">计算</span>
            </a></div>
            <ul>
              <li><a href="../../guide/topics/renderscript/compute.html">
                    <span class="en">RenderScript</span></a>
                  </li>

              <li><a href="../../guide/topics/renderscript/advanced.html">
                    <span class="en">RenderScript 进阶</span></a>
                  </li>
              <li><a href="../../guide/topics/renderscript/reference.html">
                    <span class="en">运行时 API 参考</span></a>
              </li>
             </ul>
   </li>
      <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/media/index.html">
            <span class="en">多媒体与照相机</span>
          </a></div>
          <ul>
            <li><a href="../../guide/topics/media/mediaplayer.html">
                  <span class="en">多媒体播放</span></a>
                </li>
            <li><a href="../../guide/appendix/media-formats.html">
                   <span class="en">支持的多媒体格式</span></a>
                </li>
            <li><a href="../../guide/topics/media/audio-capture.html">
                  <span class="en">音频录制</span></a>
                </li>
            <li><a href="../../guide/topics/media/jetplayer.html">
                  <span class="en">JetPlayer</span></a>
                </li>
            <li><a href="../../guide/topics/media/camera.html">
                  <span class="en">照相机</span></a>
                </li>
          </ul>
      </li><!-- end of media and camera -->

      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/sensors/index.html">
              <span class="en">位置与传感器</span>
              </a></div>
        <ul>
          <li><a href="../../guide/topics/location/index.html">
               <span class="en">位置和地图</span>
             </a>
          </li><li><a href="../../guide/topics/location/strategies.html">
               <span class="en">位置策略</span>
             </a></li>
          <li><a href="../../guide/topics/sensors/sensors_overview.html">
              <span class="en">传感器概述</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_motion.html">
              <span class="en">动作传感器</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_position.html">
              <span class="en">位置传感器</span>
            </a></li>
          <li><a href="../../guide/topics/sensors/sensors_environment.html">
              <span class="en">环境传感器</span>
            </a></li>
        </ul>
      </li><!-- end of location and sensors -->



<li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/index.html">
               <span class="en">连接性</span>
             </a></div>
        <ul>
          <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/bluetooth.html">
          <span class="en">蓝牙</span></a>
        </div>
        <ul>
          <li><a href="../../guide/topics/connectivity/bluetooth-le.html">低功耗蓝牙</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/connectivity/nfc/index.html">
          <span class="en">NFC</span></a>
        </div>
        <ul>
          <li><a href="../../guide/topics/connectivity/nfc/nfc.html">NFC 基础</a></li>
          <li><a href="../../guide/topics/connectivity/nfc/advanced-nfc.html">高级 NFC</a></li>
          <li><a href="../../guide/topics/connectivity/nfc/hce.html">Host-based Card Emulation</a></li>
        </ul>
      </li>
      <li><a href="../../guide/topics/connectivity/wifip2p.html">
            <span class="en">Wi-Fi P2P</span></a>
          </li>
      <li class="nav-section">
          <div class="nav-section-header"><a href="../../guide/topics/connectivity/usb/index.html">
            <span class="en">USB</span></a>
          </div>
            <ul>
              <li><a href="../../guide/topics/connectivity/usb/accessory.html">附件</a></li>
              <li><a href="../../guide/topics/connectivity/usb/host.html">主机</a></li>
            </ul>
     </li>
     <li><a href="../../guide/topics/connectivity/sip.html">
            <span class="en">SIP</span>
          </a>
     </li>

    </ul>
  </li><!-- end of connectivity -->


      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/topics/text/index.html">
            <span class="en">文本与输入</span>
        </a></div>
        <ul>
          <li><a href="../../guide/topics/text/copy-paste.html">
              <span class="en">复制和粘贴</span>
            </a></li>
          <li><a href="../../guide/topics/text/creating-input-method.html">
              <span class="en">创建输入法引擎</span>
            </a></li>
          <li><a href="../../guide/topics/text/spell-checker-framework.html">
              <span class="en">拼写检查</span>
            </a></li>
        </ul>
      </li><!-- end of text and input -->

     <li class="nav-section">
      <div class="nav-section-header"><a href="../../guide/topics/data/index.html">
          <span class="en">数据存储</span>
        </a></div>
      <ul>
         <li><a href="../../guide/topics/data/data-storage.html">
            <span class="en">存储选项</span>
           </a></li>
        <li><a href="../../guide/topics/data/backup.html">
            <span class="en">数据备份</span>
          </a></li>
        <li><a href="../../guide/topics/data/install-location.html">
            <span class="en">应用安装位置</span>
          </a></li>
      </ul>
    </li><!-- end of data storage -->


  <li class="nav-section">
           <div class="nav-section-header"><a href="../../guide/topics/admin/index.html">
               <span class="en">管理</span>
             </a></div>
           <ul>
              <li>
                <a href="../../guide/topics/admin/device-admin.html">
                <span class="en">设备管理</span></a>
              </li><!--
              <li>
                <a href="../../guide/topics/admin/keychain.html">
                <span class="en">Certificate Store</span></a>
              </li>
            -->
            
           </ul>
  </li><!-- end of administration -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/webapps/index.html">
    <span class="en">Web 应用</span>
    </a></div>
    <ul>
      <li><a href="../../guide/webapps/overview.html">
            <span class="en">概述</span>
          </a></li>
      <li><a href="../../guide/webapps/targeting.html">
            <span class="en">Web 应用的目标屏幕</span>
          </a></li>
      <li><a href="../../guide/webapps/webview.html">
            <span class="en">在 WebView 中创建 Web 应用</span>
          </a></li>
      <li><a href="../../guide/webapps/migrating.html">
            <span class="en">迁移到 Android 4.4 版本的 WebView</span>
          </a></li>
      <li><a href="../../guide/webapps/debugging.html">
            <span class="en">Web 应用调试</span>
          </a></li>
      <li><a href="../../guide/webapps/best-practices.html">
            <span class="en">Web 应用的最佳实践</span>
          </a></li>
    </ul>
  </li><!-- end of web apps -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/practices/index.html">
      <span class="en">最佳实践</span> <span class="de" style="display:none">Bewährte Verfahren</span> <span class="es" style="display:none">Prácticas recomendadas</span> <span class="fr" style="display:none">Meilleures pratiques</span> <span class="it" style="display:none">Best practice</span> <span class="ja" style="display:none">ベスト プラクティス</span> <span class="zh-cn" style="display:none">最佳实践</span> <span class="zh-tw" style="display:none">最佳實務</span>
    </a></div></a>
    <ul>
      <li><a href="../../guide/practices/compatibility.html">
            <span class="en">兼容性</span>
          </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/practices/screens_support.html">
          <span class="en">支持多个屏幕</span>
        </a></div>
        <ul>
          <li><a href="../../guide/practices/screens-distribution.html">
            <span class="en">分发给特定的屏幕</span>
          </a></li>
          <li><a href="../../guide/practices/screen-compat-mode.html">
            <span class="en">屏幕兼容性模式</span>
          </a></li>
        </ul>
      </li>
      <li><a href="../../guide/practices/tablets-and-handsets.html">
            <span class="en">支持平板设备和手持设备</span>
          </a></li>

    </ul>
  </li><!-- this needs to move
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../guide/practices/ui_guidelines/index.html">
               <span class="en">UI Guidelines</span>
             </a></div>
        <ul>
          <li class="nav-section">
            <div class="nav-section-header"><a href="../../guide/practices/ui_guidelines/icon_design.html">
                   <span class="en">Icon Design</span>
                 </a></div>
            <ul>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_launcher.html">
                    <span class="en">Launcher Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_menu.html">
                    <span class="en">Menu Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_action_bar.html">
                    <span class="en">Action Bar Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_status_bar.html">
                    <span class="en">Status Bar Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_tab.html">
                    <span class="en">Tab Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_dialog.html">
                    <span class="en">Dialog Icons</span>
                  </a></li>
              <li><a href="../../guide/practices/ui_guidelines/icon_design_list.html">
                    <span class="en">List View Icons</span>
                  </a></li>
            </ul>
          </li>
          <li><div><a href="../../guide/practices/ui_guidelines/widget_design.html">
                <span class="en">App Widget Design</span>
              </a></div>
          </li>
        </ul>
      </li>
        </ul> --><!-- Remove
  <li class="nav-section">
    <div class="nav-section-header"><a href="../../guide/appendix/index.html">
        <span class="en">Appendix</span>
        <span class="de" style="display:none">Anhang</span>
        <span class="es" style="display:none">Apéndice</span>
        <span class="fr" style="display:none">Annexes</span>
        <span class="it" style="display:none">Appendice</span>
        <span class="ja" style="display:none">付録</span>
        <span class="zh-cn" style="display:none">附录</span>
        <span class="zh-tw" style="display:none">附錄</span>
      </a></div>
    <ul>
      <li><a href="../../guide/appendix/g-app-intents.html">
            <span class="en">Intents List: Google Apps</span>
          </a></li>


      <li><a href="../../guide/appendix/glossary.html">
            <span class="en">Glossary</span>
          </a></li>
    </ul>
  </li>

</li>
-->

      


</ul>


<script type="text/javascript">
<!--
    buildToggleLists();
    changeNavLang(getLangPref());
//-->
</script>


        

      </div>
    </div><!-- end side-nav --> 
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="col-12" id="doc-col" >


  
    
      
        <h1 itemprop="name" >任务和活动堆栈</h1>
      
    
  


  
  <div id="jd-content">


    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
<div id="qv">
<h2>要点</h2>
<ul>
  <li>所有活动属于一个任务</li>
  <li>一个任务包括一组按用户交互顺序排序的活动</li>
  <li>任务可以移动至后台并保持每一个活动的状态，让用户执行能执行其它任务而不丢失他们的工作</li>
</ul>

<h2>在本文档中</h2>
<ol>
<li><a href="#ActivityState">保存活动状态</a></li></li>
<li><a href="#ManagingTasks">管理任务</a>
  <ol>
    <li><a href="#TaskLaunchModes">定义启动模式</a></li>
    <li><a href="#Affinities">处理相互关系</a></li>
    <li><a href="#Clearing">清空活动堆栈</a></li>
    <li><a href="#Starting">启动一个任务</a></li>
  </ol>
</li>
</ol>

<h2>文章</h2>
<ol>
  <li><a href="http://android-developers.blogspot.com/2010/04/multitasking-android-way.html">安卓的多任务之道</a></li>
</ol>

<h2>参考</h2>
<ol>
  <li><a href="../../design/patterns/navigation.html">安卓设计指南：导航</a></li>
  <li><a
href="../../guide/topics/manifest/activity-element.html"><code>&lt;activity&gt;</code> 项目清单元素</a></li>
</ol>
</div>
</div>


<p>一个应用通常包括多个<a
href="../../guide/components/activities.html">活动组件</a>。每一个活动应该关于只用特定的操作来设计，用户可以执行这些操作并能启动其它活动组件。例如，一个邮件应用可能有一个活动组件来显示新邮件的列表。当用户选择一封邮件时，一个新的活动打开来显示这封邮件。</p>

<p>一个活动能够组件甚至可以启动设备上其它应用的活动组件。例如，如果你的应用希望发送一封邮件，你可以定义一个意图来执行一个“发送”操作并包括一些数据，如邮件地址和消息。其它应用中的声明自己要处理这类意图的活动组件接着打开。在这种情况中，意图是要发送一封邮件，于是一个邮件应用的“撰写”活动组件启动（如果多个活动组件支持同一个意图，那么系统让用户选择要使用哪一个活动组件）。当邮件被发送，返回至你的活动组件，这就好像邮件活动组件是你的应用的一部分。尽管活动可能来自不同的应用，安卓系统将这些活动组件放在同一个<em>任务</em>中来维持这种连贯的用户体验。</p>

<p>一个任务是一组活动组件的集合，用户可以在执行特定任务时与这些活动交互。活动组件被安排在在一个堆栈（活动堆栈）中，它们按照活动打开顺序来排列。</p><!-- SAVE FOR WHEN THE FRAGMENT DOC IS ADDED
<div class="sidebox-wrapper">
<div class="sidebox">
<h3>Adding fragments to a task's back stack</h3>

<p>Your activity can also include <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code>s to the back stack. For example,
suppose you have a two-pane layout using fragments, one of which is a list view (fragment A) and the
other being a layout to display an item from the list (fragment B). When the user selects an item
from the list, fragment B is replaced by a new fragment (fragment C). In this case, it might be
desireable for the user to navigate back to reveal fragment B, using the <em>Back</em> button.</p>
<p>In order to add fragment B to the back stack so that this is possible, you must call <code><a href="../../reference/android/app/FragmentTransaction.html#addToBackStack(java.lang.String)">addToBackStack()</a></code> before you <code><a href="../../reference/android/app/FragmentTransaction.html#commit()">commit()</a></code> the transaction that replaces fragment B with fragment
C.</p>
<p>For more information about using fragments and adding them to the back stack, see the <code><a href="../../reference/android/app/Fragment.html">Fragment</a></code> class documentation.</p>

</div>
</div>
-->



<p>设备的主屏幕时大多数任务的起点。当用户在应用启动器中（或者主屏幕的快捷键）触摸一个图标，应用的任务出现在前台。If no task exists for the application (the application has not been used recently), then a new task is created and the "main" activity for that application opens as the root activity in the stack.</p>

<p>When the current activity starts another, the new activity is pushed on the top of the stack and
takes focus. The previous activity remains in the stack, but is stopped. When an activity
stops, the system retains the current state of its user interface. When the user presses the
<em>Back</em>
button, the current activity is popped from the top of the stack (the activity is destroyed) and the
previous activity resumes (the previous state of its UI is restored). Activities in the stack are
never rearranged, only pushed and popped from the stack—pushed onto the stack when started by
the current activity and popped off when the user leaves it using the <em>Back</em> button. As such,
the back
stack operates as a "last in, first out" object structure. Figure 1 visualizes
this behavior with a timeline showing the progress between activities along with the current back
stack at each point in time.</p>

<img src="../../images/fundamentals/diagram_backstack.png" alt="" />
<p class="img-caption"><strong>Figure 1.</strong> A representation of how each new activity in a
task adds an item to the back stack. When the user presses the <em>Back</em> button, the current
activity is
destroyed and the previous activity resumes.</p>


<p>If the user continues to press <em>Back</em>, then each activity in the stack is popped off to
reveal the
previous one, until the user returns to the Home screen (or to whichever activity was running when
the task began). When all activities are removed from the stack, the task no longer exists.</p>

<div class="figure" style="width:287px">
<img src="../../images/fundamentals/diagram_multitasking.png" alt="" /> <p
class="img-caption"><strong>Figure 2.</strong> Two tasks: Task B receives user interaction
in the foreground, while Task A is in the background, waiting to be resumed.</p>
</div>
<div class="figure" style="width:215px">
  <img src="../../images/fundamentals/diagram_multiple_instances.png" alt="" /> <p
class="img-caption"><strong>Figure 3.</strong> A single activity is instantiated multiple times.</p>
</div>

<p>A task is a cohesive unit that can move to the "background" when users begin a new task or go
to the Home screen, via the <em>Home</em> button. While in the background, all the activities in the
task are
stopped, but the back stack for the task remains intact—the task has simply lost focus while
another task takes place, as shown in figure 2. A task can then return to the "foreground" so users
can pick up where they left off. Suppose, for example, that the current task (Task A) has three
activities in its stack—two under the current activity. The user presses the <em>Home</em>
button, then
starts a new application from the application launcher. When the Home screen appears, Task A goes
into the background. When the new application starts, the system starts a task for that application
(Task B) with its own stack of activities. After interacting with
that application, the user returns Home again and selects the application that originally
started Task A. Now, Task A comes to the
foreground—all three activities in its stack are intact and the activity at the top of the
stack resumes. At
this point, the user can also switch back to Task B by going Home and selecting the application icon
that started that task (or by selecting the app's task from the <em>recent apps</em> screen).
This is an example of multitasking on Android.</p>

<p class="note"><strong>Note:</strong> Multiple tasks can be held in the background at once.
However, if the user is running many background tasks at the same time, the system might begin
destroying background activities in order to recover memory, causing the activity states to be lost.
See the following section about <a href="#ActivityState">Activity state</a>.</p>

<p>Because the activities in the back stack are never rearranged, if your application allows
users to start a particular activity from more than one activity, a new instance of
that activity is created and pushed onto the stack (rather than bringing any previous instance of
the activity to the top). As such, one activity in your application might be instantiated multiple
times (even from different tasks), as shown in figure 3. As such, if the user navigates backward
using the <em>Back</em> button, each instance of the activity is revealed in the order they were
opened (each
with their own UI state). However, you can modify this behavior if you do not want an activity to be
instantiated more than once. How to do so is discussed in the later section about <a
href="#ManagingTasks">Managing Tasks</a>.</p>


<p>To summarize the default behavior for activities and tasks:</p>

<ul>
  <li>When Activity A starts Activity B, Activity A is stopped, but the system retains its state
(such as scroll position and text entered into forms).
If the user presses the <em>Back</em> button while in Activity B, Activity A resumes with its state
restored.</li>
  <li>When the user leaves a task by pressing the <em>Home</em> button, the current activity is
stopped and
its task goes into the background. The system retains the state of every activity in the task. If
the user later resumes the task by selecting the launcher icon that began the task, the task comes
to the foreground and resumes the activity at the top of the stack.</li>
  <li>If the user presses the <em>Back</em> button, the current activity is popped from the stack
and
destroyed. The previous activity in the stack is resumed. When an activity is destroyed, the system
<em>does not</em> retain the activity's state.</li>
  <li>Activities can be instantiated multiple times, even from other tasks.</li>
</ul>


<div class="note design">
<p><strong>Navigation Design</strong></p>
  <p>For more about how app navigation works on Android, read Android Design's <a
href="../../design/patterns/navigation.html">Navigation</a> guide.</p>
</div>


<h2 id="ActivityState">保存活动状态</h2>

<p>As discussed above, the system's default behavior preserves the state of an activity when it is
stopped. This way, when users navigate back to a previous activity, its user interface appears
the way they left it. However, you can—and <strong>should</strong>—proactively retain
the state of your activities using callback methods, in case the activity is destroyed and must
be recreated.</p>

<p>When the system stops one of your activities (such as when a new activity starts or the task
moves to the background), the system might destroy that activity completely if it needs to recover
system memory. When this happens, information about the activity state is lost. If this happens, the
system still
knows that the activity has a place in the back stack, but when the activity is brought to the
top of the stack the system must recreate it (rather than resume it). In order to
avoid losing the user's work, you should proactively retain it by implementing the <code><a href="../../reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState()</a></code> callback
methods in your activity.</p>

<p>For more information about how to save your activity state, see the <a
href="../../guide/components/activities.html#SavingActivityState">Activities</a>
document.</p>



<h2 id="ManagingTasks">管理任务</h2>

<p>The way Android manages tasks and the back stack, as described above—by placing all
activities started in succession in the same task and in a "last in, first out" stack—works
great for most applications and you shouldn't have to worry about how your activities are associated
with tasks or how they exist in the back stack. However, you might decide that you want to interrupt
the normal behavior. Perhaps you want an activity in your application to begin a new task when it is
started (instead of being placed within the current task); or, when you start an activity, you want
to bring forward an existing instance of it (instead of creating a new
instance on top of the back stack); or, you want your back stack to be cleared of all
activities except for the root activity when the user leaves the task.</p>

<p>You can do these things and more, with attributes in the
<a href="../../guide/topics/manifest/activity-element.html"><code>&lt;activity&gt;</code></a> manifest element and with flags in the intent that you pass to <code><a href="../../reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code>.</p>

<p>In this regard, the principal <a
href="../../guide/topics/manifest/activity-element.html"><code>&lt;activity&gt;</code></a>
attributes you can use are:</p>

<ul class="nolist">
  <li><a href="../../guide/topics/manifest/activity-element.html#aff"><code>taskAffinity</code></a></li>
  <li><a href="../../guide/topics/manifest/activity-element.html#lmode"><code>launchMode</code></a></li>
  <li><a href="../../guide/topics/manifest/activity-element.html#reparent"><code>allowTaskReparenting</code></a></li>
  <li><a href="../../guide/topics/manifest/activity-element.html#clear"><code>clearTaskOnLaunch</code></a></li>
  <li><a href="../../guide/topics/manifest/activity-element.html#always"><code>alwaysRetainTaskState</code></a></li>
  <li><a href="../../guide/topics/manifest/activity-element.html#finish"><code>finishOnTaskLaunch</code></a></li>
</ul>

<p>And the principal intent flags you can use are:</p>

<ul class="nolist">
  <li><code><a href="../../reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK">FLAG_ACTIVITY_NEW_TASK</a></code></li>
  <li><code><a href="../../reference/android/content/Intent.html#FLAG_ACTIVITY_CLEAR_TOP">FLAG_ACTIVITY_CLEAR_TOP</a></code></li>
  <li><code><a href="../../reference/android/content/Intent.html#FLAG_ACTIVITY_SINGLE_TOP">FLAG_ACTIVITY_SINGLE_TOP</a></code></li>
</ul>

<p>In the following sections, you'll see how you can use these manifest attributes and intent
flags to define how activities are associated with tasks and how the behave in the back stack.</p>


<p class="caution"><strong>Caution:</strong> Most applications should not interrupt the default
behavior for activities and tasks. If you determine that it's necessary for your activity to modify
the default behaviors, use caution and be sure to test the usability of the activity during
launch and when navigating back to it from other activities and tasks with the <em>Back</em> button.
Be sure 
to test for navigation behaviors that might conflict with the user's expected behavior.</p>


<h3 id="TaskLaunchModes">定义启动模式</h3>

<p>Launch modes allow you to define how a new instance of an activity is associated with the
current task. You can define different launch modes in two ways:</p>
<ul class="nolist">
  <li><a href="#ManifestForTasks">Using the manifest file</a>
    <p>When you declare an activity in your manifest file, you can specify how the activity
should associate with tasks when it starts.</li>
  <li><a href="#IntentFlagsForTasks">Using Intent flags</a>
    <p>When you call <code><a href="../../reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code>,
you can include a flag in the <code><a href="../../reference/android/content/Intent.html">Intent</a></code> that declares how (or
whether) the new activity should associate with the current task.</p></li>
</ul>

<p>As such, if Activity A starts Activity B, Activity B can define in its manifest how it
should associate with the current task (if at all) and Activity A can also request how Activity
B should associate with current task. If both activities define how Activity B
should associate with a task, then Activity A's request (as defined in the intent) is honored
over Activity B's request (as defined in its manifest).</p>

<p class="note"><strong>Note:</strong> Some launch modes available for the manifest file
are not available as flags for an intent and, likewise, some launch modes available as flags
for an intent cannot be defined in the manifest.</p>


<h4 id="ManifestForTasks">Using the manifest file</h4>

<p>When declaring an activity in your manifest file, you can specify how the activity should
associate with a task using the <a
href="../../guide/topics/manifest/activity-element.html"><code>&lt;activity&gt;</code></a>
element's <a href="../../guide/topics/manifest/activity-element.html#lmode"><code>launchMode</code></a> attribute.</p>

<p>The <a href="../../guide/topics/manifest/activity-element.html#lmode"><code>launchMode</code></a> attribute specifies an instruction on how the activity should be launched into a
task. There are four different launch modes you can assign to the
<code><a href="../../guide/topics/manifest/activity-element.html#lmode">launchMode</a></code>
attribute:</p>

<dl>
<dt><code>"standard"</code> (the default mode)</dt>
  <dd>Default. The system creates a new instance of the activity in the task from
which it was started and routes the intent to it. The activity can be instantiated multiple times,
each instance can belong to different tasks, and one task can have multiple instances.</dd>
<dt><code>"singleTop"</code></dt>
  <dd>If an instance of the activity already exists at the top of the current task, the system
routes the intent to that instance through a call to its <code><a href="../../reference/android/app/Activity.html#onNewIntent(android.content.Intent)">onNewIntent()</a></code> method, rather than creating a new instance of the
activity. The activity can be instantiated multiple times, each instance can
belong to different tasks, and one task can have multiple instances (but only if the
activity at the top of the back stack is <em>not</em> an existing instance of the activity).
  
  <p>For example, suppose a task's back stack consists of root activity A with activities B, C,
and D on top (the stack is A-B-C-D; D is on top). An intent arrives for an activity of type D.
If D has the default <code>"standard"</code> launch mode, a new instance of the class is launched and the
stack becomes A-B-C-D-D. However, if D's launch mode is <code>"singleTop"</code>, the existing instance
of D receives the intent through <code><a href="../../reference/android/app/Activity.html#onNewIntent(android.content.Intent)">onNewIntent()</a></code>, because it's at the top of the stack—the
stack remains A-B-C-D. However, if an intent arrives for an activity of type B, then a new
instance of B is added to the stack, even if its launch mode is <code>"singleTop"</code>.</p>
  <p class="note"><strong>Note:</strong> When a new instance of an activity is created,
the user can press the <em>Back</em> button to return to the previous activity. But when an existing
instance of
an activity handles a new intent, the user cannot press the <em>Back</em> button to return to the
state of
the activity before the new intent arrived in <code><a href="../../reference/android/app/Activity.html#onNewIntent(android.content.Intent)">onNewIntent()</a></code>.</p>
</dd>

<dt><code>"singleTask"</code></dt>
  <dd>The system creates a new task and instantiates the activity at the root of the new task.
However, if an instance of the activity already exists in a separate task, the system routes the
intent to the existing instance through a call to its <code><a href="../../reference/android/app/Activity.html#onNewIntent(android.content.Intent)">onNewIntent()</a></code> method, rather than creating a new instance. Only
one instance of the activity can exist at a time.
  
  <p class="note"><strong>Note:</strong> Although the activity starts in a new task, the
<em>Back</em> button still returns the user to the previous activity.</p></dd>
<dt><code>"singleInstance"</code>.</dt>
  <dd>Same as <code>"singleTask"</code>, except that the system doesn't launch any other activities into
the task holding the instance. The activity is always the single and only member of its task;
any activities started by this one open in a separate task.</dd>
</dl>


<p>As another example, the Android Browser application declares that the web browser activity should
always open in its own task—by specifying the <code>singleTask</code> launch mode in the <a
href="../../guide/topics/manifest/activity-element.html"><code>&lt;activity&gt;</code></a> element.
This means that if your application issues an
intent to open the Android Browser, its activity is <em>not</em> placed in the same
task as your application. Instead, either a new task starts for the Browser or, if the Browser
already has a task running in the background, that task is brought forward to handle the new
intent.</p>

<p>Regardless of whether an activity starts in a new task or in the same task as the activity that
started it, the <em>Back</em> button always takes the user to the previous activity. However, if you
start an activity that specifies the <code>singleTask</code> launch mode, then if an instance of
that activity exists in a background task, that whole task is brought to the foreground. At this
point, the back stack now includes all activities from the task brought forward, at the top of the
stack. Figure 4 illustrates this type of scenario.</p>

<img src="../../images/fundamentals/diagram_backstack_singletask_multiactivity.png" alt="" />
<p class="img-caption"><strong>Figure 4.</strong> A representation of how an activity with
launch mode "singleTask" is added to the back stack. If the activity is already a part of a
background task with its own back stack, then the entire back stack also comes
forward, on top of the current task.</p>

<p>For more information about using launch modes in the manifest file, see the
<code><a href="../../guide/topics/manifest/activity-element.html">&lt;activity&gt;</a></code>
element documentation, where the <code>launchMode</code> attribute and the accepted values are
discussed more.</p>

<p class="note"><strong>Note:</strong> The behaviors that you specify for your activity with the <a
href="../../guide/topics/manifest/activity-element.html#lmode"><code>launchMode</code></a> attribute
can be overridden by flags included with the intent that start your activity, as discussed in the
next section.</p>



<h4 id="#IntentFlagsForTasks">Using Intent flags</h4>

<p>When starting an activity, you can modify the default association of an activity to its task
by including flags in the intent that you deliver to <code><a href="../../reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code>. The flags you can use to modify the
default behavior are:</p>

<p>
  <dt><code><a href="../../reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK">FLAG_ACTIVITY_NEW_TASK</a></code></dt>
    <dd>Start the activity in a new task. If a task is already running for the activity you are now
starting, that task is brought to the foreground with its last state restored and the activity
receives the new intent in <code><a href="../../reference/android/app/Activity.html#onNewIntent(android.content.Intent)">onNewIntent()</a></code>. 
     
    <p>This produces the same behavior as the <code>"singleTask"</code> <a
href="../../guide/topics/manifest/activity-element.html#lmode"><code>launchMode</code></a> value,
discussed in the previous section.</p></dd>
  <dt><code><a href="../../reference/android/content/Intent.html#FLAG_ACTIVITY_SINGLE_TOP">FLAG_ACTIVITY_SINGLE_TOP</a></code></dt>
    <dd>If the activity being started is the current activity (at the top of the back stack), then
the existing instance receives a call to <code><a href="../../reference/android/app/Activity.html#onNewIntent(android.content.Intent)">onNewIntent()</a></code>,
instead of creating a new instance of the activity.
    
    <p>This produces the same behavior as the <code>"singleTop"</code> <a
href="../../guide/topics/manifest/activity-element.html#lmode"><code>launchMode</code></a> value,
discussed in the previous section.</p></dd>
  <dt><code><a href="../../reference/android/content/Intent.html#FLAG_ACTIVITY_CLEAR_TOP">FLAG_ACTIVITY_CLEAR_TOP</a></code></dt>
    <dd>If the activity being started is already running in the current task, then instead
of launching a new instance of that activity, all of the other activities on top of it are
destroyed and this intent is delivered to the resumed instance of the activity (now on top),
through <code><a href="../../reference/android/app/Activity.html#onNewIntent(android.content.Intent)">onNewIntent()</a></code>).
    
    <p>There is no value for the <a
href="../../guide/topics/manifest/activity-element.html#lmode"><code>launchMode</code></a>
attribute that produces this behavior.</p>
    <p><code>FLAG_ACTIVITY_CLEAR_TOP</code> is most often used in conjunction with <code>FLAG_ACTIVITY_NEW_TASK</code>.  When used together, these flags are a way of locating an existing activity
in another task and putting it in a position where it can respond to the intent.  </p>
    <p class="note"><strong>Note:</strong> If the launch mode of the designated activity is <code>"standard"</code>, it too is removed from the stack and a new instance is launched in its place to handle
the incoming intent.  That's because a new instance is always created for a new intent when the
launch mode is <code>"standard"</code>.  </p>
</dd>
</dl>





<h3 id="Affinities">处理相互关系</h3>

<p>The <em>affinity</em> indicates which task an activity prefers to belong to. By default, all the
activities from the same application have an affinity for each other. So, by default, all
activities in the same application prefer to be in the same task. However, you can modify
the default affinity for an activity. Activities defined in
different applications can share an affinity, or activities defined in the same application can be
assigned different task affinities.</p>

<p>You can modify the affinity for any given activity with the <a
href="../../guide/topics/manifest/activity-element.html#aff"><code>taskAffinity</code></a> attribute
of the <a href="../../guide/topics/manifest/activity-element.html"><code>&lt;activity&gt;</code></a>
element.</p>

<p>The <a
href="../../guide/topics/manifest/activity-element.html#aff"><code>taskAffinity</code></a>
attribute takes a string value, which must be unique from the default package name
declared in the <a href="../../guide/topics/manifest/manifest-element.html"><code>&lt;manifest&gt;</code></a> element, because the system uses that name to identify the default task
affinity for the application.</p>

<p>The affinity comes into play in two circumstances:</p>
<ul>
  <li>When the intent that launches an activity contains the <code><a href="../../reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK">FLAG_ACTIVITY_NEW_TASK</a></code> flag.



<p>A new activity is, by default, launched into the task of the activity
that called <code><a href="../../reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code>. It's pushed onto the same
back stack as the caller.  However, if the intent passed to <code><a href="../../reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code> contains the <code><a href="../../reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK">FLAG_ACTIVITY_NEW_TASK</a></code>
flag, the system looks for a different task to house the new activity. Often, it's a new task. 
However, it doesn't have to be.  If there's already an existing task with the same affinity as the
new activity, the activity is launched into that task.  If not, it begins a new task.</p>

<p>If this flag causes an activity to begin a new task and the user presses the <em>Home</em> button
to leave
it, there must be some way for the user to navigate back to the task. Some entities (such as the
notification manager) always start activities in an external task, never as part of their own, so
they always put <code>FLAG_ACTIVITY_NEW_TASK</code> in the intents they pass to <code><a href="../../reference/android/app/Activity.html#startActivity(android.content.Intent)">startActivity()</a></code>.  If you have an activity that can be invoked by
an external entity that might use this flag, take care that the user has a independent way to get
back to the task that's started, such as with a launcher icon (the root activity of the task
has a <code><a href="../../reference/android/content/Intent.html#CATEGORY_LAUNCHER">CATEGORY_LAUNCHER</a></code> intent filter; see the <a
href="#Starting">Starting a task</a> section below).</p>
</li>

  <li>When an activity has its <a
href="../../guide/topics/manifest/activity-element.html#reparent"><code>allowTaskReparenting</code></a> attribute set to <code>"true"</code>.
  
  <p>In this case, the activity can move from the task it starts to the task it has an affinity
for, when that task comes to the foreground.</p>
  <p>For example, suppose that an activity that reports weather conditions in selected cities is
defined as part of a travel application.  It has the same affinity as other activities in the same
application (the default application affinity) and it allows re-parenting with this attribute.
When one of your activities starts the weather reporter activity, it initially belongs to the same
task as your activity. However, when the travel application's task comes to the foreground, the
weather reporter activity is reassigned to that task and displayed within it.</p>
</li>
</ul>

<p class="note"><strong>Tip:</strong> If an <code>.apk</code> file contains more than one "application"
from the user's point of view, you probably want to use the <a
href="../../guide/topics/manifest/activity-element.html#aff"><code>taskAffinity</code></a>
attribute to assign different affinities to the activities associated with each "application".</p>



<h3 id="Clearing">清空活动堆栈</h3>

<p>If the user leaves a task for a long time, the system clears the task of all activities except
the root activity.  When the user returns to the task again, only the root activity is restored.
The system behaves this way, because, after an extended amount of time, users likely have abandoned
what they were doing before and are returning to the task to begin something new.  </p>

<p>There are some activity attributes that you can use to modify this behavior:  </p>

<dl>
<dt><code><a
href="../../guide/topics/manifest/activity-element.html#always">alwaysRetainTaskState</a></code>
</dt>
<dd>If this attribute is set to <code>"true"</code> in the root activity of a task,
the default behavior just described does not happen.
The task retains all activities in its stack even after a long period.</dd>

<dt><code><a
href="../../guide/topics/manifest/activity-element.html#clear">clearTaskOnLaunch</a></code></dt>
<dd>If this attribute is set to <code>"true"</code> in the root activity of a task,
the stack is cleared down to the root activity whenever the user leaves the task
and returns to it.  In other words, it's the opposite of <a
href="../../guide/topics/manifest/activity-element.html#always"><code>alwaysRetainTaskState</code></a>.  The user always returns to the task in its
initial state, even after a leaving the task for only a moment.</dd>

<dt><code><a
href="../../guide/topics/manifest/activity-element.html#finish">finishOnTaskLaunch</a></code>
</dt>
<dd>This attribute is like <a
href="../../guide/topics/manifest/activity-element.html#clear"><code>clearTaskOnLaunch</code></a>,
but it operates on a
single activity, not an entire task.  It can also cause any activity to go
away, including the root activity.  When it's set to <code>"true"</code>, the
activity remains part of the task only for the current session.  If the user
leaves and then returns to the task, it is no longer present.</dd>
</dl>




<h3 id="Starting">启动一个任务</h3>

<p>You can set up an activity as the entry point for a task by giving it an intent filter with <code>"android.intent.action.MAIN"</code> as the specified action and <code>"android.intent.category.LAUNCHER"</code> as the specified category. 例如：</p>

<pre>
&lt;activity ... &gt;
    &lt;intent-filter ... &gt;
        &lt;action android:name="android.intent.action.MAIN" /&gt;
        &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
    &lt;/intent-filter&gt;
    ...
&lt;/activity&gt;
</pre>

<p>An intent filter of this kind causes an icon and label for the
activity to be displayed in the application launcher, giving users a way to launch the activity and
to return to the task that it creates any time after it has been launched.

</p>

<p>This second ability is important: Users must be able to leave a task and then come back to it
later using this activity launcher.  For this reason, the two <a href="#LaunchModes">launch
modes</a> that mark activities as always initiating a task, <code>"singleTask"</code> and "<code>"singleInstance"</code>, should be used only when the activity has an <code><a href="../../reference/android/content/Intent.html#ACTION_MAIN">ACTION_MAIN</a></code>
and a <code><a href="../../reference/android/content/Intent.html#CATEGORY_LAUNCHER">CATEGORY_LAUNCHER</a></code>
filter. Imagine, for example, what could happen if the filter is missing: An intent launches a
<code>"singleTask"</code> activity, initiating a new task, and the user spends some time working in
that task.  The user then presses the <em>Home</em> button. The task is now sent to the background
and is
not visible. Now the user has no way to return to the task, because it is not represented in the
application launcher.

</p>

<p>For those cases where you don't want the user to be able to return to an activity, set the
  <code><a
href="../../guide/topics/manifest/activity-element.html">&lt;activity&gt;</a></code> element's
<a href="../../guide/topics/manifest/activity-element.html#finish"><code>finishOnTaskLaunch</code></a> to <code>"true"</code> (see <a
href="#Clearing">Clearing the stack</a>).</p><!--
<h2>Beginner's Path</h2>

<p>For more information about how to use intents to
activate other application components and publish the intents to which your components
respond, continue with the <b><a
href="../../guide/components/intents-filters.html">Intents and Intent
Filters</a></b> document.</p>
-->





    </div>
      
      <div class="content-footer layout-content-row" 
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="layout-content-col col-8" style="padding-top:4px">
          
            <div class="g-plusone" data-size="medium"></div>
          
        </div>
        
        <div class="paging-links layout-content-col col-4">
          
        </div>
        
      </div>
      
      
      

  </div><!-- end jd-content --> 

<div id="footer" class="wrap" >
        

  <div id="copyright">
    
  
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../license.html">Content 
  License</a>.
  
  </div>


  <div id="footerlinks">
    
  <p>
    <a href="../../about/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../support.html">Support</a>
  </p>
  </div>

</div><!-- end footer --> 
</div><!-- end doc-content -->

</div><!-- end body-content -->  






</body>
</html>



